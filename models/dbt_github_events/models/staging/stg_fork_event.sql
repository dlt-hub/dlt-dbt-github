/* Table: fork_event */
{{
    config(
        materialized='view'
    )
}}
-- depends_on: {{ ref('dlt_active_load_ids') }}

SELECT
/* select which columns will be available for table 'fork_event' */
    id,
    type,
    actor__id,
    actor__login,
    actor__display_login,
    actor__gravatar_id,
    actor__url,
    actor__avatar_url,
    repo__id,
    repo__name,
    repo__url,
    payload__forkee__id,
    payload__forkee__node_id,
    payload__forkee__name,
    payload__forkee__full_name,
    payload__forkee__private,
    payload__forkee__owner,
    payload__forkee__html_url,
    payload__forkee__description,
    payload__forkee__fork,
    payload__forkee__url,
    payload__forkee__forks_url,
    payload__forkee__keys_url,
    payload__forkee__collaborators_url,
    payload__forkee__teams_url,
    payload__forkee__hooks_url,
    payload__forkee__issue_events_url,
    payload__forkee__events_url,
    payload__forkee__assignees_url,
    payload__forkee__branches_url,
    payload__forkee__tags_url,
    payload__forkee__blobs_url,
    payload__forkee__git_tags_url,
    payload__forkee__git_refs_url,
    payload__forkee__trees_url,
    payload__forkee__statuses_url,
    payload__forkee__languages_url,
    payload__forkee__stargazers_url,
    payload__forkee__contributors_url,
    payload__forkee__subscribers_url,
    payload__forkee__subscription_url,
    payload__forkee__commits_url,
    payload__forkee__git_commits_url,
    payload__forkee__comments_url,
    payload__forkee__issue_comment_url,
    payload__forkee__contents_url,
    payload__forkee__compare_url,
    payload__forkee__merges_url,
    payload__forkee__archive_url,
    payload__forkee__downloads_url,
    payload__forkee__issues_url,
    payload__forkee__pulls_url,
    payload__forkee__milestones_url,
    payload__forkee__notifications_url,
    payload__forkee__labels_url,
    payload__forkee__releases_url,
    payload__forkee__deployments_url,
    payload__forkee__created_at,
    payload__forkee__updated_at,
    payload__forkee__pushed_at,
    payload__forkee__git_url,
    payload__forkee__ssh_url,
    payload__forkee__clone_url,
    payload__forkee__svn_url,
    payload__forkee__homepage,
    payload__forkee__size,
    payload__forkee__stargazers_count,
    payload__forkee__watchers_count,
    payload__forkee__has_issues,
    payload__forkee__has_projects,
    payload__forkee__has_downloads,
    payload__forkee__has_wiki,
    payload__forkee__has_pages,
    payload__forkee__has_discussions,
    payload__forkee__forks_count,
    payload__forkee__archived,
    payload__forkee__disabled,
    payload__forkee__open_issues_count,
    payload__forkee__allow_forking,
    payload__forkee__is_template,
    payload__forkee__web_commit_signoff_required,
    payload__forkee__topics,
    payload__forkee__visibility,
    payload__forkee__forks,
    payload__forkee__open_issues,
    payload__forkee__watchers,
    payload__forkee__default_branch,
    payload__forkee__public,
    public,
    created_at,
    org__id,
    org__login,
    org__gravatar_id,
    org__url,
    org__avatar_url,
    _dlt_load_id,
    _dlt_id,
FROM {{ source('raw_data', 'fork_event') }}

/* we only load table items of the currently active load ids into the staging table */
WHERE _dlt_load_id IN ( SELECT load_id FROM  {{ ref('dlt_active_load_ids') }} )